(()=>{"use strict";var e={};function t(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,i)}return o}function o(e){for(var o=1;o<arguments.length;o++){var i=null!=arguments[o]?arguments[o]:{};o%2?t(Object(i),!0).forEach((function(t){r(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):t(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function i(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function r(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}e.d=(t,o)=>{for(var i in o)e.o(o,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:o[i]})},e.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var n=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,n;return t=e,n=[{key:"fireFacebookEvent",value:function(e,t,i){var r=["PageView","ViewContent","Search","AddToCart","AddToWishlist","InitiateCheckout","AddPaymentInfo","Purchase","Lead","Subscribe"],n="track";if(r.includes(t)||"Scroll"===t&&(n="trackCustom"),r.includes(t)||"Scroll"===t){if(this.setAllQueryVars(),"Lead"===t){var a=parseInt(window.OPDashboardPixels.facebookFirstVisitCookieDuration);this.setCookie("op3_matching",JSON.stringify(i),a)}if(i=o(o({},this.getInitialEventData()),i),fbq(n,t,i,{eventID:e}),"1"===window.OPDashboardPixels.enableCapi&&window.OPDashboardPixels.capiAccessToken){var s={pixel:"facebook",pixelID:window.OPDashboardPixels.fbPixelId,eventName:t,eventData:i,url:window.location.href,eventID:e};setTimeout((function(){jQuery.post({url:window.OPDashboardPixels.capiRestUrl,data:s,headers:{"Cache-Control":"no-cache"},success:function(){}})}),500)}}}},{key:"getInitialEventData",value:function(){var e=window.OPDashboardPixels.standardParams,t=this.getDateTime();e.landing_page=window.location.href.split("?")[0],e.traffic_source=this.getTrafficSource(),e.event_time=t[0],e.event_day=t[1],e.event_month=t[2],e.event_day_in_month=t[3];var o=this.getUTMs("last_visit"===window.OPDashboardPixels.facebookAttribution);return this.utmTerms.forEach((function(t,i){t in o&&(e[t]=o[t])})),e}},{key:"getMatchingDataFromCookie",value:function(){var e=this.getCookie("op3_matching"),t={};if(e){var o=JSON.parse(e);o.email&&(t.email=o.email),o.first_name&&(t.first_name=o.first_name),o.last_name&&(t.last_name=o.last_name)}return t}},{key:"getDateTime",value:function(){var e=[],t=new Date;return e.push(["00-01","01-02","02-03","03-04","04-05","05-06","06-07","07-08","08-09","09-10","10-11","11-12","12-13","13-14","14-15","15-16","16-17","17-18","18-19","19-20","20-21","21-22","22-23","23-24"][t.getHours()]),e.push(["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][t.getDay()]),e.push(["January","February","March","April","May","June","July","August","September","October","November","December"][t.getMonth()]),e.push(t.getDate()),e}},{key:"getUTMs",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];try{var t="op_",o=this;e&&(t="last_op_");var i=[];return this.utmTerms.forEach((function(e,r){if(o.getCookie(t+e)){var n=o.getCookie(t+e);i[e]=o.filterEmails(n)}})),i}catch(e){return console.error(e),[]}}},{key:"setAllQueryVars",value:function(){var e=parseInt(window.OPDashboardPixels.facebookFirstVisitCookieDuration),t=this.getQueryVars(),o=window.location.href.split("?")[0],i=this;try{null===this.getCookie("op_first_visit")&&(this.setCookie("op_first_visit",!0,e),this.setCookie("op_traffic_source",this.getTrafficSource(),e),this.setCookie("op_landing_page",o,e),i.utmTerms.forEach((function(o,r){t.hasOwnProperty(o)?i.setCookie("op_"+o,t[o],e):i.deleteCookie("op_"+o)})),i.utmIds.forEach((function(o,r){t.hasOwnProperty(o)?i.setCookie("op_"+o,t[o],e):i.deleteCookie("op_"+o)}))),this.checkSession()&&(this.setCookie("last_op_traffic_source",this.getTrafficSource(),e),this.utmTerms.forEach((function(o,r){t.hasOwnProperty(o)?i.setCookie("last_op_"+o,t[o],e):i.deleteCookie("last_op_"+o)})),this.utmIds.forEach((function(o,r){t.hasOwnProperty(o)?i.setCookie("last_op_"+o,t[o],e):i.deleteCookie("last_op_"+o)})),this.setCookie("last_op_landing_page",o,e))}catch(e){console.error(e)}}},{key:"getQueryVars",value:function(){try{var e={},t=[];return window.location.search.substring(1).split("&").forEach((function(o){(t=o.split("=")).length>1&&(e[t[0]]=t[1])})),e}catch(e){return console.error(e),{}}}},{key:"getTrafficSource",value:function(){try{var e,t=document.referrer.toString(),o=0===t.length,i=!o&&0===t.indexOf(OP3.Meta.siteUrl);return"direct"!==(e=!1==(!o&&!i)?"direct":t)?this.getDomain(e):e}catch(e){return console.error(e),"direct"}}},{key:"getDomain",value:function(e){return-1!==(e=e.replace(/(https?:\/\/)?(www.)?/i,"")).indexOf("/")?e.split("/")[0]:e}},{key:"checkSession",value:function(){var e=window.OPDashboardPixels.facebookLastVisitCookieDuration/1440;return(null===this.getCookie("op_start_session")||null===this.getCookie("op_session_limit"))&&(this.setCookie("op_session_limit",!0,e),this.setCookie("op_start_session",!0),!0)}},{key:"setCookie",value:function(e,t,o){var i="";if(o){var r=new Date;r.setTime(r.getTime()+24*o*60*60*1e3),i="; expires="+r.toUTCString()}document.cookie=e+"="+(t||"")+i+"; path=/"}},{key:"getCookie",value:function(e){for(var t=e+"=",o=decodeURIComponent(document.cookie).split(";"),i=0;i<o.length;i++){for(var r=o[i];" "===r.charAt(0);)r=r.substring(1,r.length);if(0===r.indexOf(t))return r.substring(t.length,r.length)}return null}},{key:"deleteCookie",value:function(e){document.cookie=e+"=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;"}},{key:"isEmail",value:function(e){return/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)}},{key:"filterEmails",value:function(e){return this.isEmail(e)?void 0:e}}],(r=null)&&i(t.prototype,r),n&&i(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();r(n,"utmTerms",["utm_source","utm_medium","utm_campaign","utm_content","utm_term","fbclid"]),r(n,"utmIds",["fbadid","gadid","padid","bingid"]),window.OP3Pixels=n})();
//# sourceMappingURL=OP3Pixels.js.map